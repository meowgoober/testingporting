<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Sort the Court!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/style.css">
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/favicon.ico" />
    <script src="https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/UnityProgress.js"></script>
  </head>
  <body class="template">
    <p class="header"><span>Unity WebGL Player | </span>Sort the Court!</p>
    <div class="template-wrap clear">
      <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" height="540px" width="960px"></canvas>
      <br>
      <div class="logo"></div>
      <div class="fullscreen"><img src="https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/fullscreen.png" width="38" height="38" alt="Fullscreen" title="Fullscreen" onclick="SetFullscreen(1);" /></div>
      <div class="title">Sort the Court!</div>
    </div>
    <p class="footer">&laquo; created with <a href="http://unity3d.com/" title="Go to unity3d.com">Unity</a> &raquo;</p>

    <script type='text/javascript'>
      // Function to fetch the parts and merge them into a usable URL
      async function getFileBlob(url, partCount) {
        const parts = [];
        for (let i = 0; i < partCount; i++) {
          const response = await fetch(`${url}.part${i}`);
          if (!response.ok) throw new Error("Failed to load: " + url);
          parts.push(await response.arrayBuffer());
        }
        return URL.createObjectURL(new Blob(parts, { type: "application/octet-stream" }));
      }

      var Module = {
        TOTAL_MEMORY: 268435456,
        errorhandler: null,
        compatibilitycheck: null,
        dataUrl: "",
        codeUrl: "",
        memUrl: ""
      };

      (async () => {
        const baseUrl = "https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/";
        try {
          // 1. Reassemble the split files (using .part0 as seen in your folder)
          const [data, code, mem] = await Promise.all([
            getFileBlob(baseUrl + "WebGL.datagz", 1),
            getFileBlob(baseUrl + "WebGL.jsgz", 1),
            getFileBlob(baseUrl + "WebGL.memgz", 1)
          ]);

          Module.dataUrl = data;
          Module.codeUrl = code;
          Module.memUrl = mem;

          // 2. CRITICAL: Tell the loader to decompress these blobs using Gzip
          // This stops the "Unexpected token <" or "Invalid token" errors
          Module.filePackageConfig = {
            'dataUrl': { 'compression': 'gzip' },
            'codeUrl': { 'compression': 'gzip' },
            'memUrl':  { 'compression': 'gzip' }
          };
          
          // Fallback for older Unity loaders
          Module.decompression = { 'gz': 'gzip' };

          // 3. Load the UnityLoader script ONLY after the blobs are ready
          var script = document.createElement('script');
          script.src = baseUrl + "UnityLoader.js";
          document.body.appendChild(script);

        } catch (e) {
          console.error("Unity Loading Error: ", e);
        }
      })();
    </script>

    <script defer src="https://cdn.jsdelivr.net/gh/meowgoober/testingporting@main/solvethecourt/htmlgame.js" type="text/javascript"></script>
  </body>
</html>